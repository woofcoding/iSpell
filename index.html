<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Year 6 Spelling Test</title>
  <style>
    :root { --accent: #4a7d97; --ok: #4CAF50; --bad: #f44336; --muted:#777; }
    body{font-family:Arial,Helvetica,sans-serif;background:#f0f8ff;padding:20px;margin:0}
    #container{max-width:820px;margin:0 auto;background:#fff;padding:28px;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,.08);position:relative}
    h1{color:var(--accent);margin:0 0 10px; text-align: center;}
    /* corner image */
    .corner-woofs{position:absolute;top:12px;right:12px;width:64px;height:auto;pointer-events:none}
    /* controls in top-left */
    .top-controls{position:absolute;top:12px;left:12px;display:flex;flex-direction:column;gap:8px;z-index:11}
    .toggle-row{display:flex;align-items:center;gap:8px;font-size:.95rem;color:#555;user-select:none}
    .toggle-row input{width:18px;height:18px;cursor:pointer}
    /* week selector area */
    #weekBar{display:flex;align-items:center;gap:12px;margin:8px 0 18px;flex-wrap:wrap;justify-content:center}
    #weekBar label{font-weight:600;color:#555}
    #weekSelect{padding:6px 8px;border-radius:6px;border:1px solid #ccc;background:#fff}
    #weekInfo{margin-left:8px;text-align:left}
    #weekLabel{font-weight:700;color:var(--accent)}
    #weekDate{font-size:.9rem;color:var(--muted)}
    /* start screen */
    #startScreen{display:flex;flex-direction:column;gap:14px;align-items:center;padding:18px}
    .primary-action{padding:12px 20px;border-radius:10px;border:none;cursor:pointer;background:var(--ok);color:#fff;font-size:1.05rem}
    /* test UI */
    #status-area{display:flex;justify-content:space-between;align-items:center;width:80%;margin:0 auto 10px;box-sizing:border-box}
    #progress{font-weight:700;color:var(--accent)}
    #score{font-weight:700;color:#1a7d32}
    #progressBarContainer{width:80%;margin:0 auto 18px;display:flex;background:#e0e0e0;border-radius:6px;overflow:hidden;height:14px}
    .progressSegment{flex:1;background:#ccc;transition:background-color .25s}
    .progressSegment.correct{background:#4CAF50}
    .progressSegment.incorrect{background:#f44336}
    #contextDisplay{min-height:40px;margin:12px 0;padding:12px;border-radius:8px;border:2px dashed #008CBA;background:#e6f7ff;font-style:italic;display:none}
    #wordInput{padding:12px;margin:12px 0;width:80%;font-size:1.2rem;border-radius:8px;border:2px solid #ccc;text-align:center;display:block;margin-left:auto;margin-right:auto}
    #button-group{display:flex;gap:10px;justify-content:center;margin-bottom:12px;flex-wrap:wrap}
    button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
    #speakWordButton{background:#ff9900;color:#fff}
    #speakSentenceButton{background:var(--accent);color:#fff}
    #submitButton{background:var(--ok);color:#fff}
    /* Center the continue button when visible */
    #continueButton{background:var(--bad);color:#fff;display:none;margin:12px auto 0; /* centered */ padding:10px 14px}
    #message{margin-top:14px;text-align:center;font-weight:700;min-height:26px}
    /* results */
    #results{margin-top:22px;text-align:left;display:none}
    #results h2{color:var(--accent)}
    #resultsTable{width:100%;border-collapse:collapse;margin-top:8px}
    #resultsTable th,#resultsTable td{border:1px solid #ddd;padding:8px;text-align:center}
    .correct{background:#e6ffe6}
    .incorrect{background:#ffe6e6}
    #startAgainButton{margin-top:12px;background:var(--ok);color:#fff;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;float:right}
    #menuButton{margin-top:12px;background:#4a7d97;color:#fff;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;float:left}
    @media (max-width:640px){ #status-area,#progressBarContainer,#wordInput{width:95%} }
  </style>
</head>
<body>
  <div id="container">
    <img class="corner-woofs" src="Woofs.png" alt="Woofs">

    <!-- top-left toggles: sound and show-sentence -->
    <div class="top-controls" aria-hidden="false">
      <label class="toggle-row" for="soundToggle">
        <input id="soundToggle" type="checkbox" /> <span id="soundLabel">Sound effects</span>
      </label>
      <label class="toggle-row" for="showSentenceToggle">
        <input id="showSentenceToggle" type="checkbox" /> <span id="showSentenceLabel">Show sentence</span>
      </label>
    </div>

    <h1>üìù Weekly Spelling Test</h1>

    <!-- week selector + info -->
    <div id="weekBar" aria-hidden="false">
      <label for="weekSelect">Choose week:</label>
      <select id="weekSelect" aria-label="Choose week"></select>
      <div id="weekInfo" aria-hidden="false">
  <!--      <div id="weekLabel"></div> -->
  <!--     <div id="weekDate"></div> -->
      </div>
    </div>

    <!-- start screen -->
    <div id="startScreen" role="region" aria-label="Start screen">
      <p id="startBlurb">Press Start to begin the spelling test for the selected week.</p>
      <button id="startButton" class="primary-action">Start Test</button>
      <p style="font-size:.9rem;color:#666;margin:0">Tip: press Enter once the test starts to submit answers quickly.</p>
    </div>

    <!-- test interface -->
    <div id="test-interface" style="display:none">
      <div id="status-area">
        <p id="progress">Word 1 of 20</p>
        <p id="score">Score: 0 / 0</p>
      </div>
      <div id="progressBarContainer" aria-hidden="true"></div>

      <div id="contextDisplay" role="region" aria-live="polite"></div>

      <input id="wordInput" type="text" placeholder="Type the word here‚Ä¶" autocomplete="off" />

      <div id="button-group">
        <button id="speakWordButton">üîä Hear Word</button>
        <button id="speakSentenceButton">üìñ Hear Sentence</button>
        <button id="submitButton">‚úÖ Submit Answer</button>
      </div>

      <div id="message" aria-live="polite"></div>
      <button id="continueButton">‚û°Ô∏è Continue</button>
    </div>

    <!-- results -->
    <div id="results" aria-live="polite">
      <h2>Detailed Results Log</h2>
      <table id="resultsTable">
        <thead>
          <tr><th>#</th><th>Your Spelling</th><th>Correct Spelling</th><th>Status</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <button id="menuButton">Menu</button>
      <button id="startAgainButton">Start Again</button>
    </div>
  </div>

  <script>
    // ======================
    // WEEKS DATA (easy to update)
    // ======================
    const weeksData = [
      {
        id: "2025-10-23",
        label: "Set 23 Oct ‚Äî Test Fri 7 Nov 2025",
        date: "2025-10-23",
        words: [
          { word: "rhyme", sentence: "The children learned a funny rhyme to help remember the spelling." },
          { word: "secretary", sentence: "The secretary typed up the meeting minutes quickly." },
          { word: "sincere", sentence: "He made a sincere apology after accidentally breaking the vase." },
          { word: "sufficient", sentence: "We have sufficient pencils for everyone in the class." },
          { word: "system", sentence: "The school's heating system was repaired over the holidays." },
          { word: "rhythm", sentence: "She clapped the rhythm of the song perfectly in music class." },
          { word: "shoulder", sentence: "He carried the bag on his shoulder as he walked home." },
          { word: "soldier", sentence: "The soldier marched bravely in the parade." },
          { word: "suggest", sentence: "May I suggest a different book for the class reading?" },
          { word: "temperature", sentence: "The nurse took my temperature before I returned to class." },
          { word: "sacrifice", sentence: "They made a small sacrifice of their break time to finish the experiment." },
          { word: "signature", sentence: "Please write your signature at the bottom of the form." },
          { word: "stomach", sentence: "Her stomach rumbled loudly during the quiet assembly." },
          { word: "symbol", sentence: "The dove is often used as a symbol of peace." },
          { word: "thorough", sentence: "Make a thorough check of your answers before handing them in." },
          { word: "twelfth", sentence: "This is the twelfth question on the worksheet." },
          { word: "variety", sentence: "The market sold a variety of fresh fruits and snacks." },
          { word: "vegetable", sentence: "He chose one vegetable from the tray for his soup." },
          { word: "vehicle", sentence: "A large vehicle delivered the new desks to the school." },
          { word: "sincerely", sentence: "She finished the letter with 'Yours sincerely' and signed her name." }
        ]
      },
      {
        id: "2025-11-07",
        label: "Set 7 Nov ‚Äî Test Fri 14 Nov 2025",
        date: "2025-11-07",
        words: [
          { word: "observant", sentence: "The traffic warden was very observant and spotted the illegal parking." },
          { word: "hesitant", sentence: "She was hesitant to answer the question, taking a long pause first." },
          { word: "tolerance", sentence: "The garden grows well because of its high tolerance to frost." },
          { word: "decent", sentence: "I hope you have a decent amount of money saved for the trip." },
          { word: "frequency", sentence: "The bus runs at a high frequency, arriving every fifteen minutes." },
          { word: "observance", sentence: "The observance of rules is critical for safety." },
          { word: "hesitancy", sentence: "His slight hesitancy gave the opposition time to think." },
          { word: "innocent", sentence: "The court decided the boy was innocent of the crime." },
          { word: "decency", sentence: "The children were taught common decency, like saying please and thank you." },
          { word: "confident", sentence: "She felt confident in her ability to pass the difficult exam." },
          { word: "expectant", sentence: "The whole crowd was expectant as the singer walked onto the stage." },
          { word: "tolerant", sentence: "We must be tolerant of other people's views, even if we disagree." },
          { word: "innocence", sentence: "He maintained his innocence throughout the long trial." },
          { word: "frequent", sentence: "Frequent visits to the library improved her reading skills." },
          { word: "confidence", sentence: "Winning the tournament boosted the team's confidence." },
          { word: "assistant", sentence: "The shop assistant helped the customer find the correct size." },
          { word: "assistance", sentence: "The old man requested assistance with his heavy bags." },
          { word: "obedient", sentence: "The soldier was obedient and followed all the orders given." },
          { word: "independent", sentence: "She became independent after moving out of her family home." },
          { word: "independence", sentence: "The country celebrated its day of independence from foreign rule." }
        ]
      }
    ];

    // ----------------------
    // DOM refs & state
    // ----------------------
    let spellingList = [];
    let currentWeek = null;
    let currentWordIndex = 0;
    let score = 0;
    let resultsLog = [];

    const weekSelectEl = document.getElementById('weekSelect');
    const weekLabelEl = document.getElementById('weekLabel');
    const weekDateEl = document.getElementById('weekDate');
    const weekBarEl = document.getElementById('weekBar');

    const startScreenEl = document.getElementById('startScreen');
    const startButtonEl = document.getElementById('startButton');

    const testInterfaceEl = document.getElementById('test-interface');
    const progressEl = document.getElementById('progress');
    const scoreEl = document.getElementById('score');
    const progressBarContainerEl = document.getElementById('progressBarContainer');
    const inputEl = document.getElementById('wordInput');
    const messageEl = document.getElementById('message');
    const speakWordButtonEl = document.getElementById('speakWordButton');
    const speakSentenceButtonEl = document.getElementById('speakSentenceButton');
    const submitButtonEl = document.getElementById('submitButton');
    const continueButtonEl = document.getElementById('continueButton');

    const resultsEl = document.getElementById('results');
    const resultsTableBodyEl = document.querySelector('#resultsTable tbody');
    const startAgainButtonEl = document.getElementById('startAgainButton');
    const menuButtonEl = document.getElementById('menuButton');

    // toggles
    const soundToggleEl = document.getElementById('soundToggle');
    const showSentenceToggleEl = document.getElementById('showSentenceToggle');
    const SOUND_KEY = 'spellingSoundEnabled';
    const SHOW_SENTENCE_KEY = 'spellingShowSentence';
    let soundEnabled = localStorage.getItem(SOUND_KEY) === null ? true : localStorage.getItem(SOUND_KEY) === 'true';
    let showSentenceEnabled = localStorage.getItem(SHOW_SENTENCE_KEY) === null ? true : localStorage.getItem(SHOW_SENTENCE_KEY) === 'true';
    soundToggleEl.checked = soundEnabled;
    showSentenceToggleEl.checked = showSentenceEnabled;
    const soundLabelEl = document.getElementById('soundLabel');
    const showSentenceLabelEl = document.getElementById('showSentenceLabel');
    soundLabelEl.textContent = soundEnabled ? 'Sound effects' : 'Sound effects (off)';
    showSentenceLabelEl.textContent = showSentenceEnabled ? 'Show sentence' : 'Show sentence (off)';

    soundToggleEl.addEventListener('change', () => {
      soundEnabled = soundToggleEl.checked;
      localStorage.setItem(SOUND_KEY, String(soundEnabled));
      soundLabelEl.textContent = soundEnabled ? 'Sound effects' : 'Sound effects (off)';
      if (!soundEnabled && audioCtx && audioCtx.state !== 'closed') audioCtx.suspend().catch(()=>{});
      else if (soundEnabled && audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
    });

    showSentenceToggleEl.addEventListener('change', () => {
      showSentenceEnabled = showSentenceToggleEl.checked;
      localStorage.setItem(SHOW_SENTENCE_KEY, String(showSentenceEnabled));
      showSentenceLabelEl.textContent = showSentenceEnabled ? 'Show sentence' : 'Show sentence (off)';
      // update display for current word immediately
      if (testInterfaceEl.style.display !== 'none') {
        if (showSentenceEnabled) displayBlankedSentence(currentWordIndex);
        else { document.getElementById('contextDisplay').style.display = 'none'; }
      }
    });

    // ======================
    // Voice / audio
    // ======================
    let selectedUKVoice = null;
    function loadVoices() {
      const voices = speechSynthesis.getVoices() || [];
      if (!voices.length) return;
      selectedUKVoice =
        voices.find(v => v.lang && v.lang.toLowerCase().includes('en-gb') && /female/i.test(v.name)) ||
        voices.find(v => v.lang && v.lang.toLowerCase().includes('en-gb')) ||
        null;
    }
    loadVoices();
    speechSynthesis.onvoiceschanged = loadVoices;

    function createUtterance(text) {
      const u = new SpeechSynthesisUtterance(text);
      if (selectedUKVoice) { u.voice = selectedUKVoice; u.rate = 0.9; }
      else u.lang = 'en-GB';
      return u;
    }

    // WebAudio for feedback
    let audioCtx = null;
    function ensureAudioContext() {
      if (!soundEnabled) return null;
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
      return audioCtx;
    }
    function playCorrectSound() {
      if (!soundEnabled) return;
      const ctx = ensureAudioContext(); if (!ctx) return;
      const now = ctx.currentTime; const o = ctx.createOscillator(); const g = ctx.createGain();
      o.type='sine'; o.frequency.setValueAtTime(880, now); o.frequency.exponentialRampToValueAtTime(1320, now+0.14);
      g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.25, now+0.01); g.gain.exponentialRampToValueAtTime(0.001, now+0.5);
      o.connect(g); g.connect(ctx.destination); o.start(now); o.stop(now+0.6);
    }
    function playWrongSound() {
      if (!soundEnabled) return;
      const ctx = ensureAudioContext(); if (!ctx) return;
      const now = ctx.currentTime; const o1 = ctx.createOscillator(), o2 = ctx.createOscillator(), g = ctx.createGain();
      o1.type='sawtooth'; o1.frequency.setValueAtTime(220, now);
      o2.type='sine'; o2.frequency.setValueAtTime(270, now);
      g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.22, now+0.01); g.gain.exponentialRampToValueAtTime(0.001, now+0.5);
      o1.connect(g); o2.connect(g); g.connect(ctx.destination); o1.start(now); o2.start(now+0.02); o1.stop(now+0.45); o2.stop(now+0.45);
    }

    // ======================
    // Week selector logic
    // ======================
    function populateWeekSelect() {
      weekSelectEl.innerHTML = '';
      const sorted = weeksData.slice().sort((a,b)=> new Date(a.date) - new Date(b.date));
      for (const w of sorted) {
        const opt = document.createElement('option');
        opt.value = w.id;
        opt.textContent = `${w.label} ‚Äî ${w.date}`;
        weekSelectEl.appendChild(opt);
      }
      const defaultIndex = findMostRelevantWeekIndex(sorted);
      weekSelectEl.selectedIndex = defaultIndex;
      loadWeek(sorted[defaultIndex]);
    }

    function findMostRelevantWeekIndex(sortedWeeks) {
      const today = new Date(); const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      let candidate = -1;
      for (let i = 0; i < sortedWeeks.length; i++) {
        const d = new Date(sortedWeeks[i].date);
        if (isNaN(d)) continue;
        if (d <= todayOnly) candidate = i;
      }
      if (candidate !== -1) return candidate;
      return sortedWeeks.length ? sortedWeeks.length - 1 : 0;
    }

    function loadWeekById(id) {
      const week = weeksData.find(w => w.id === id);
      if (week) loadWeek(week);
    }

    function loadWeek(week) {
      currentWeek = week;
      spellingList = week.words.slice();
      weekLabelEl.textContent = week.label || '';
      weekDateEl.textContent = week.date || '';
      document.title = `Y6 Spelling Test ‚Äî ${week.label || week.date || ''}`;
      resetToStartScreen();
      buildProgressBar();
    }
    weekSelectEl.addEventListener('change', (e)=> loadWeekById(e.target.value));

    // ======================
    // Core test logic
    // ======================
    function buildProgressBar() {
      progressBarContainerEl.innerHTML = '';
      for (let i=0;i<spellingList.length;i++){
        const seg = document.createElement('div');
        seg.className = 'progressSegment';
        progressBarContainerEl.appendChild(seg);
      }
    }
    function updateScoreAndProgress() {
      const wordsCompleted = resultsLog.length;
      scoreEl.textContent = `Score: ${score} / ${wordsCompleted}`;
      if (currentWordIndex < spellingList.length) progressEl.textContent = `Word ${currentWordIndex + 1} of ${spellingList.length}`;
      const segments = progressBarContainerEl.children;
      for (let i=0;i<segments.length;i++){
        segments[i].className = 'progressSegment';
        if (i < resultsLog.length) segments[i].classList.add(resultsLog[i].isCorrect ? 'correct' : 'incorrect');
      }
    }
    function toggleButtons(enable){
      submitButtonEl.disabled = !enable;
      speakWordButtonEl.disabled = !enable;
      speakSentenceButtonEl.disabled = !enable;
      inputEl.disabled = !enable;
    }
    function updateProgressScreen() {
      inputEl.value = '';
      messageEl.textContent = '';
      const ctx = document.getElementById('contextDisplay');
      ctx.textContent = '';
      ctx.style.display = 'none';
      continueButtonEl.style.display = 'none';
      toggleButtons(true);
      inputEl.focus();
      updateScoreAndProgress();
      // If "Show sentence" is enabled, display blanked sentence for the current word (but do not speak it)
      if (showSentenceToggleEl.checked) displayBlankedSentence(currentWordIndex);
    }

    function displayBlankedSentence(index) {
      const ctx = document.getElementById('contextDisplay');
      if (!spellingList || index == null || index >= spellingList.length) { ctx.style.display = 'none'; return; }
      const item = spellingList[index];
      const regex = new RegExp(escapeRegExp(item.word), 'gi');
      const blanked = item.sentence.replace(regex, '______');
      ctx.innerHTML = blanked;
      ctx.style.display = 'block';
    }

    function speakWord() {
      if (!spellingList || currentWordIndex >= spellingList.length) return;
      const word = spellingList[currentWordIndex].word;
      const utt = createUtterance(word);
      messageEl.textContent = "üîä Speaking the word...";
      document.getElementById('contextDisplay').style.display = 'none';
      speechSynthesis.speak(utt);
      inputEl.focus();
      // If show-sentence is enabled, display the blanked sentence (but don't read it)
      if (showSentenceToggleEl.checked) displayBlankedSentence(currentWordIndex);
    }

    function speakSentence() {
      if (!spellingList || currentWordIndex >= spellingList.length) return;
      const item = spellingList[currentWordIndex];
      const regex = new RegExp(escapeRegExp(item.word), 'gi');
      const blanked = item.sentence.replace(regex, '______');
      const ctx = document.getElementById('contextDisplay');
      ctx.innerHTML = blanked;
      ctx.style.display = 'block';
      messageEl.textContent = "üìñ Speaking the sentence context...";
      speechSynthesis.speak(createUtterance(item.sentence));
      inputEl.focus();
    }

    function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }

    function checkSpelling() {
      if (!spellingList || currentWordIndex >= spellingList.length) return;
      const typed = inputEl.value.trim();
      const correct = spellingList[currentWordIndex].word;
      if (!typed) { messageEl.textContent = "‚ö†Ô∏è Please type a word first!"; return; }
      const isCorrect = typed.toLowerCase() === correct.toLowerCase();
      resultsLog.push({ index: currentWordIndex+1, submittedWord: typed, correctWord: correct, isCorrect });
      toggleButtons(false);
      if (isCorrect) {
        playCorrectSound();
        score++;
        messageEl.textContent = "‚úÖ Correct!";
        currentWordIndex++;
        updateScoreAndProgress();
        setTimeout(nextStep, 700);
      } else {
        playWrongSound();
        messageEl.textContent = `‚ùå Incorrect ‚Äî correct: "${correct}".`;
        currentWordIndex++;
        updateScoreAndProgress();
        // Show centered Continue button when incorrect
        continueButtonEl.style.display = 'block';
        continueButtonEl.focus();
      }
    }

    function nextStep(){
      if (currentWordIndex < spellingList.length) {
        updateProgressScreen();
        speakWord();
      } else {
        finishTest();
      }
    }

    function displayResults(){
      testInterfaceEl.style.display = 'none';
      resultsEl.style.display = 'block';
      resultsTableBodyEl.innerHTML = '';
      for (const log of resultsLog) {
        const row = resultsTableBodyEl.insertRow();
        row.className = log.isCorrect ? 'correct' : 'incorrect';
        row.insertCell().textContent = log.index;
        row.insertCell().textContent = log.submittedWord;
        row.insertCell().textContent = log.correctWord;
        row.insertCell().textContent = log.isCorrect ? 'Correct' : 'Incorrect';
      }
    }

    function finishTest() {
      progressEl.textContent = "TEST FINISHED!";
      scoreEl.textContent = `Final Score: ${score} / ${spellingList.length}`;
      messageEl.textContent = `üéâ You scored ${score} out of ${spellingList.length}!`;
      updateScoreAndProgress();
      displayResults();
      // hide sentence/submit while on results
      speakSentenceButtonEl.style.display = 'none';
      submitButtonEl.style.display = 'none';
      continueButtonEl.style.display = 'none';
      // Hide week selector on results (user requested Menu/Home instead of selector on results)
      weekBarEl.style.display = 'none';
      // show Start Again and Menu
      startAgainButtonEl.style.display = 'inline-block';
      menuButtonEl.style.display = 'inline-block';
    }

    // start/reset helpers
    function startTest() {
      if (soundEnabled) ensureAudioContext();
      // hide week selector once the test starts
      weekBarEl.style.display = 'none';
      // restore UI
      speakSentenceButtonEl.style.display = 'inline-block';
      submitButtonEl.style.display = 'inline-block';
      continueButtonEl.style.display = 'none';
      startScreenEl.style.display = 'none';
      resultsEl.style.display = 'none';
      testInterfaceEl.style.display = 'block';
      // reset state
      currentWordIndex = 0;
      score = 0;
      resultsLog = [];
      buildProgressBar();
      updateProgressScreen();
      // speak first word automatically
      setTimeout(speakWord, 300);
    }

    function resetToStartScreen() {
      currentWordIndex = 0;
      score = 0;
      resultsLog = [];
      inputEl.value = '';
      messageEl.textContent = '';
      testInterfaceEl.style.display = 'none';
      resultsEl.style.display = 'none';
      startScreenEl.style.display = 'flex';
      // show week selector on start screen
      weekBarEl.style.display = 'flex';
      // hide menu button while on start screen
      menuButtonEl.style.display = 'none';
      // hide startAgain until needed
      startAgainButtonEl.style.display = 'none';
    }

    function resetAndStartImmediate() { resetToStartScreen(); setTimeout(startTest, 80); }

    // ======================
    // Event wiring
    // ======================
    startButtonEl.addEventListener('click', ()=> { if (soundEnabled) ensureAudioContext(); startTest(); });
    speakWordButtonEl.addEventListener('click', ()=> {
      if (soundEnabled) ensureAudioContext();
      if (testInterfaceEl.style.display === 'none') { startTest(); return; }
      speakWord();
    });
    speakSentenceButtonEl.addEventListener('click', ()=> { if (soundEnabled) ensureAudioContext(); speakSentence(); });
    submitButtonEl.addEventListener('click', ()=> { if (soundEnabled) ensureAudioContext(); checkSpelling(); });
    continueButtonEl.addEventListener('click', ()=> { if (soundEnabled) ensureAudioContext(); nextStep(); inputEl.focus(); });
    startAgainButtonEl.addEventListener('click', resetAndStartImmediate);
    menuButtonEl.addEventListener('click', resetToStartScreen);

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        if (startScreenEl.style.display !== 'none') { e.preventDefault(); startTest(); }
        else if (continueButtonEl.style.display === 'inline-block') { e.preventDefault(); continueButtonEl.click(); }
        else if (!submitButtonEl.disabled) { e.preventDefault(); checkSpelling(); }
      }
    });

    // ======================
    // Initialization
    // ======================
    populateWeekSelect();
    // initial toggle/button visibility
    startAgainButtonEl.style.display = 'none';
    menuButtonEl.style.display = 'none';
    // Default: show sentence toggle on by default (persisted above)
    if (showSentenceToggleEl.checked) {
      showSentenceToggleEl.dispatchEvent(new Event('change'));
    }
  </script>
</body>
</html>



